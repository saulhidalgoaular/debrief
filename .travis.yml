language: java
jdk: oraclejdk8
sudo: required
cache:
  directories:
    - $HOME/.m2
install:
- mvn --version
addons:
  apt:
    packages:
    - intltool
    - libgsf-1-dev
    - uuid-runtime
    - libglib2.0-dev
    - libxml2-dev
    - pdftk
before_script:
- export DISPLAY=:99
- sh -e /etc/init.d/xvfb start
- sleep 3
- ./install-msitools.sh
script: mvn clean verify -U -B -fae
after_success:
- ls /home/travis/build/debrief/debrief/org.mwc.cmap.combined.feature/root_installs
# - ./contribs/msi/make_x32msi.sh  
- ./contribs/msi/make_x64msi.sh
deploy:
  provider: releases
  skip_cleanup: true
  file_glob: true
  draft: true
  api_key:
    secure: d78bd8032e98238baef197df5f43ecd1e28f3cfb
  file:
    - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Linux64Bit.zip
    - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-MacOSX64Bit.zip
    # - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Windows32Bit.zip
    - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Windows64Bit.zip
    - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/P2_Repository.zip.zip
    - /home/travis/build/debrief/debrief/org.mwc.debrief.legacy/dist/DebriefLite*.jar
    - /home/travis/build/debrief/debrief/org.mwc.debrief.lite/dist/debrief-lite*.zip
    - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Windows32Bit.msi
    - /home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Windows64Bit.msi
  on:
     tags: true
     all_branches: true
